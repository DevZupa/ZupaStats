"use strict";var ZupaStats=angular.module("ZupaStats",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angularLocalStorage","ui.bootstrap","angularUtils.directives.dirPagination","toaster","tc.chartjs"]);ZupaStats.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/servers",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/kills",{templateUrl:"views/kills.html",controller:"KillsCtrl"}).when("/players",{templateUrl:"views/players.html",controller:"PlayersCtrl"}).when("/weapons",{templateUrl:"views/weapons.html",controller:"WeaponsCtrl"}).when("/player/:param",{templateUrl:"views/player.html",controller:"PlayerCtrl"}).when("/stats",{templateUrl:"views/stats.html",controller:"StatsCtrl"}).otherwise({redirectTo:"/"})}]),ZupaStats.run(["$rootScope","storage","$location","$http","Data",function(a,b,c,d){function e(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b}function f(){m.loadingData=!0,d.post(m.serverURL+"getNoLogDeathLogs.php?date="+(new Date).getTime(),{db:m.selectedServer.dbi}).success(function(a){m.data=a,g(a)}).error(function(){m.loadingData=!1})}function g(a){m.players={},m.weapons={};var b=new Date;angular.forEach(a,function(a){if(void 0!=a.killerpuid&&""!=a.killerpuid&&(a.killerpuid in m.players||(m.players[a.killerpuid]={},m.players[a.killerpuid].names=[],m.players[a.killerpuid].puid=a.killerpuid,m.players[a.killerpuid].killsData=[],m.players[a.killerpuid].killedData=[],m.players[a.killerpuid].killsData7Days=[],m.players[a.killerpuid].killedData7Days=[],m.players[a.killerpuid].weapons={}),-1==$.inArray(a.killername,m.players[a.killerpuid].names)&&m.players[a.killerpuid].names.push(a.killername),void 0!=a.killedpuid&&""!=a.killedpuid&&" "!=a.killedpuid)){m.players[a.killerpuid].killsData.push(a);var c=new Date(a.time),d=Math.abs(b.getTime()-c.getTime()),e=Math.ceil(d/864e5);8>e&&m.players[a.killerpuid].killsData7Days.push(a)}if(void 0!=a.killedpuid&&""!=a.killedpuid){a.killedpuid in m.players||(m.players[a.killedpuid]={},m.players[a.killedpuid].names=[],m.players[a.killedpuid].killsData=[],m.players[a.killedpuid].puid=a.killedpuid,m.players[a.killedpuid].killedData=[],m.players[a.killedpuid].killsData7Days=[],m.players[a.killedpuid].killedData7Days=[],m.players[a.killedpuid].weapons={}),-1==$.inArray(a.killedname,m.players[a.killedpuid].names)&&m.players[a.killedpuid].names.push(a.killedname),m.players[a.killedpuid].killedData.push(a);var c=new Date(a.time),d=Math.abs(b.getTime()-c.getTime()),e=Math.ceil(d/864e5);8>e&&m.players[a.killedpuid].killedData7Days.push(a)}void 0!=a.weapon&&""!=a.weapon&&" "!=a.weapon&&(a.weapon.trim()in m.weapons||(m.weapons[a.weapon.trim()]={},m.weapons[a.weapon.trim()].name=a.weapon,m.weapons[a.weapon.trim()].count=0),m.weapons[a.weapon].count++,void 0!=a.killerpuid&&""!=a.killerpuid&&(a.weapon.trim()in m.players[a.killerpuid].weapons||(m.players[a.killerpuid].weapons[a.weapon.trim()]={},m.players[a.killerpuid].weapons[a.weapon.trim()].name=a.weapon,m.players[a.killerpuid].weapons[a.weapon.trim()].count=0),m.players[a.killerpuid].weapons[a.weapon].count++))}),m.weapons2=[],angular.forEach(m.weapons,function(a){m.weapons2.push(a)}),m.weapons2.sort(h),m.players2=[],angular.forEach(m.players,function(a){a.kd=0==a.killedData.length?a.killsData.length:a.killsData.length/a.killedData.length,a.kd7=0==a.killedData7Days.length?a.killsData7Days.length:a.killsData7Days.length/a.killedData7Days.length,m.players2.push(a)}),m.players2.sort(j),angular.forEach(m.players2,function(a){m.players6.push(a)}),m.players2.sort(i),m.weapons3=[];var c=1;angular.forEach(m.weapons2,function(a){a.rank=c,m.weapons3.push(a),c++}),c=1,m.players3=[],angular.forEach(m.players2,function(a){a.rank=c,m.players3.push(a),c++}),m.players2.sort(k),c=1,m.players4=[],angular.forEach(m.players2,function(a){a.kdrank=c,a.killsData.length>19&&(m.players4.push(a),c++)}),m.players2.sort(l),c=1,m.players5=[],angular.forEach(m.players2,function(a){a.kdrank=c,a.killsData.length>9&&(m.players5.push(a),c++)}),m.loadingData=!1}function h(a,b){return a.count<b.count?1:a.count>b.count?-1:0}function i(a,b){return a.killsData.length<b.killsData.length?1:a.killsData.length>b.killsData.length?-1:0}function j(a,b){return a.killsData7Days.length<b.killsData7Days.length?1:a.killsData7Days.length>b.killsData7Days.length?-1:0}function k(a,b){return a.kd<b.kd?1:a.kd>b.kd?-1:0}function l(a,b){return a.kd7<b.kd7?1:a.kd7>b.kd7?-1:0}var m=a;d.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",m.players=[],m.weapons=[],m.weapons3=[],m.weapons4=[],m.weapons2=[],m.players3=[],m.players4=[],m.players2=[],m.players5=[],m.players6=[],m.data=[],m.serverURL="server/",m.servers=[],m.angular="Zupa",m.version="1.0",m.communnity="",m.selectedServer={},d.post(m.serverURL+"getServers.php?date="+(new Date).getTime(),{db:m.selectedServer.dbi}).success(function(a){m.servers=a,m.selectedServer=m.servers[0],m.communnity=m.selectedServer.community,g(a)}).error(function(){alert("No server connection or misformed config file")}),m.getRandomColor=e,m.getData=f,m.unEpochorize=g}]),ZupaStats.factory("Data",["$http","toaster",function(a,b){var c="server/",d={};return d.toast=function(a){b.pop(a.status,"",a.message,1e4,"trustedHtml")},d.get=function(b){return a.get(c+b).then(function(a){return a.data},function(){return{}})},d.post=function(b,d){return a.post(c+b,d).then(function(a){return a.data},function(){return{}})},d.put=function(b,d){return a.put(c+b,d).then(function(a){return a.data},function(){return{}})},d["delete"]=function(b){return a["delete"](c+b).then(function(a){return a.data},function(){return{}})},d}]),ZupaStats.directive("focus",function(){return function(a,b){b[0].focus()}}),ZupaStats.directive("passwordMatch",[function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(a,b,c,d){var e=function(){var b=a.$eval(c.ngModel),d=a.$eval(c.passwordMatch);return null!=d?b==d:void 0};a.$watch(e,function(a){d.$setValidity("passwordNoMatch",a)})}}}]),ZupaStats.controller("MainCtrl",["$scope","$rootScope","$location","$http",function(a,b,c){function d(a){g.selectedServer=g.servers[a],g.getData(),e("/stats")}function e(a){c.path(a)}$(".nav li").removeClass("active"),$("#servers").addClass("active");var f=a,g=b;f.changeLoc=e,f.selectServer=d}]),ZupaStats.controller("KillsCtrl",["$scope","$rootScope","$location","$http",function(a,b,c){function d(a){e("/player/"+a)}function e(a){c.path(a)}$(".nav li").removeClass("active"),$("#kills").addClass("active");var f=a;f.currentPage=1,f.pageSize=20,f.changeLoc=e,f.view=d}]),ZupaStats.controller("WeaponsCtrl",["$scope","$rootScope","$location","$http",function(a,b,c){function d(a){g.selectedServer=g.servers[a],e("/kills")}function e(a){c.path(a)}$(".nav li").removeClass("active"),$("#weapons").addClass("active");var f=a,g=b;f.changeLoc=e,f.currentPage=1,f.pageSize=20,f.selectServer=d}]),ZupaStats.controller("PlayersCtrl",["$scope","$rootScope","$location","$http",function(a,b,c){function d(a){h.selectedServer=h.servers[a],e("/kills")}function e(a){c.path(a)}function f(a){e("/player/"+a)}$(".nav li").removeClass("active"),$("#players").addClass("active");var g=a,h=b;g.changeLoc=e,g.selectServer=d,g.currentPage=1,g.pageSize=20,g.view=f}]),ZupaStats.controller("PlayerCtrl",["$scope","$rootScope","$location","$routeParams",function(a,b,c,d){function e(a){c.path(a)}function f(){void 0!=h.puid&&""!=h.puid?(angular.forEach(i.players4,function(a){a.puid==h.puid&&(h.thePlayer=a)}),h.pkills=h.thePlayer.killsData,h.pDeaths=h.thePlayer.killedData,h.pWeapons=[],angular.forEach(h.thePlayer.weapons,function(a){h.pWeapons.push(a)}),h.pWeapons.sort(g)):h.thePlayer.name="Error player"}function g(a,b){return a.count<b.count?1:a.count>b.count?-1:0}$(".nav li").removeClass("active"),$("#players").addClass("active");var h=a,i=b;h.changeLoc=e,h.currentPage=1,h.pageSize=20,h.puid=d.param,h.thePlayer={},h.pkills=[],h.pDeaths=[],h.pWeapons=[],i.$watch("players4",function(){f()}),f()}]),ZupaStats.controller("StatsCtrl",["$scope","$rootScope","$location","$http",function(a,b,c){function d(a){h.selectedServer=h.servers[a],e("/kills")}function e(a){c.path(a)}function f(){g.tempDate=[];var a=0;angular.forEach(h.weapons3,function(b){if(5>a){var c={};c.value=b.count,c.color=h.getRandomColor(),c.highlight="#aaa",c.label=b.name,g.tempDate.push(c),a++}}),g.weaponsTop=g.tempDate,g.tempDate=[],a=0,angular.forEach(h.players4,function(b){if(5>a){var c={};c.value=b.kd,c.color=h.getRandomColor(),c.highlight="#aaa",c.label=b.names[0],g.tempDate.push(c),a++}}),g.kdrTop=g.tempDate,g.tempDate=[],a=0,angular.forEach(h.players3,function(b){if(5>a){var c={};c.value=b.killsData.length,c.color=h.getRandomColor(),c.highlight="#aaa",c.label=b.names[0],g.tempDate.push(c),a++}}),g.killsTop=g.tempDate,g.tempDate=[],a=0,angular.forEach(h.players6,function(b){if(5>a){var c={};c.value=b.killsData7Days.length,c.color=h.getRandomColor(),c.highlight="#aaa",c.label=b.names[0],g.tempDate.push(c),a++}}),g.killsTop7=g.tempDate,g.tempDate=[],a=0,angular.forEach(h.players5,function(b){if(5>a){var c={};c.value=b.kd7,c.color=h.getRandomColor(),c.highlight="#aaa",c.label=b.names[0],g.tempDate.push(c),a++}}),g.kdTop7=g.tempDate}$(".nav li").removeClass("active"),$("#stats").addClass("active");var g=a,h=b;g.changeLoc=e,g.selectServer=d,g.weaponsTop=[],g.kdrTop=[],g.killsTop=[],g.killsTop7=[],g.kdTop7=[],h.$watch("players5",function(){f()}),a.options={responsive:!1,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!0,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},a.optionsPolar={responsive:!0,scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBeginAtZero:!0,scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,scaleShowLine:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'}}]);